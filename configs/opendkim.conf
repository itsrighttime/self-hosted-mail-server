# ==========================================
# OpenDKIM Main Configuration File
# Location: conf/opendkim/opendkim.conf
# ==========================================

# Run as dedicated user
UserID                  opendkim:opendkim

# Logging
Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes

# Mode
# s = sign
# v = verify
Mode                    sv

# Canonicalization (recommended for compatibility)
Canonicalization        relaxed/simple

# Domain handling
SubDomains              no
OversignHeaders         From

# Key and signing tables
KeyTable                /etc/opendkim/KeyTable
SigningTable            refile:/etc/opendkim/SigningTable
TrustedHosts            /etc/opendkim/TrustedHosts

# Internal hosts (who can send mail to be signed)
InternalHosts           /etc/opendkim/TrustedHosts

# Socket configuration (Postfix connects here)
Socket                  inet:12345@localhost

# PID file
PidFile                 /var/run/opendkim/opendkim.pid

# Umask for key security
UMask                   002

# Maximum message size (optional hardening)
MaximumSignedBytes      10M

# Auto-restart protection
AutoRestart             yes
AutoRestartRate         10/1h

# Temporary directory
TemporaryDirectory      /var/tmp

# Strict header handling
RemoveOldSignatures     yes
RequireSafeKeys         yes

# Background mode
Background              yes