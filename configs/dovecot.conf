# ===============================
# Dovecot Main Configuration File
# Location: conf/dovecot/dovecot.conf
# ===============================

# Enable required protocols
protocols = imap pop3 lmtp

# Listen on all interfaces (IPv4 + IPv6)
listen = *

# Log configuration
log_path = /var/log/dovecot.log
info_log_path = /var/log/dovecot-info.log
log_timestamp = "%Y-%m-%d %H:%M:%S "

# Mail storage format (Maildir per user)
mail_location = maildir:~/Maildir

# First valid UID for mail users
first_valid_uid = 1000

# Authentication mechanisms
auth_mechanisms = plain login

# Disable plaintext authentication unless using TLS
disable_plaintext_auth = yes

# Include modular configuration files
!include conf.d/*.conf

# ===============================
# SSL / TLS Configuration
# ===============================

ssl = required

ssl_cert = </etc/letsencrypt/live/mail.itsrighttime.group/fullchain.pem
ssl_key  = </etc/letsencrypt/live/mail.itsrighttime.group/privkey.pem

ssl_min_protocol = TLSv1.2
ssl_cipher_list = HIGH:!aNULL:!MD5

# ===============================
# LMTP Configuration (for Postfix)
# ===============================

protocol lmtp {
  mail_plugins = $mail_plugins
}

# ===============================
# IMAP Configuration
# ===============================

protocol imap {
  mail_plugins = $mail_plugins
}

# ===============================
# POP3 Configuration
# ===============================

protocol pop3 {
  mail_plugins = $mail_plugins
}

# ===============================
# Authentication Service
# ===============================

service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}

# ===============================
# Login Limits & Performance
# ===============================

default_process_limit = 100
service imap-login {
  service_count = 1
  process_limit = 100
}

service pop3-login {
  service_count = 1
  process_limit = 50
}